<!doctype html>
<html lang="en" ng-app="timesync">

<head>
  <title>Time Server (An Observeris Project)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/bootstrap-responsive.min.css">
  <style>
    body {
      padding-top: 60px;
    }
  </style>

</head>
<script type="text/javascript" src="/bower_components/socket.io/socket.io.js"></script>
<script type="text/javascript" src="/bower_components/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/bower_components/angular/angular.min.js"></script>
<script type="text/javascript" src="/bower_components/angular-resource/angular-resource.min.js"></script>
<script type="text/javascript" src="/bower_components/angular-route/angular-route.min.js"></script>

<!-- NTP client-server connector -->
<script type="text/javascript" src="/bower_components/socket-ntp/ntp.js"></script>

<!-- Core Angular App -->
<script type="text/javascript" src="/app/app.js"></script>

<!-- Extra Services for our Angular App -->
<script type="text/javascript" src="/app/services/socket-ntp-sync.js"></script>

<body>
  <div class="tx-out" ng-controller="TimeSyncController as timer">
    <p>Controller name: {{timer.fTitle}}</p>
    <p>Controller data: {{timer.fStringData}}</p>
    <p>Average delta: {{timer.fServerData.fDeltaData.fAverageServerNTPDelta}}</p>
    <p>Server Time: {{timer.fServerData.fDeltaData.fServerTime}}</p>
    <p>Server Time MS: {{timer.fServerData.fDeltaData.fServerTimeMS}}</p>
    <p>Adjusted Server Time: {{timer.fServerData.fDeltaData.fAdjustedServerTime}}</p>
    
    <p>Local Time: {{timer.fClientData.fSystemTime}}</p>
    <p>Most Precise Local Time: {{timer.fClientData.fMostPreciseTime}}</p>
    <p>Socket NTP offset: {{timer.fSocketNTPData}}</p>
  </div>


  <script>
    // Initialize synchronizer on launch then check every 3 seconds, output into tx-out div at HTML page.

    var socket = window.io.connect();

    window.ntp.init(socket);

    //timerTick checks the current offset value. At first the value will be NaN since no communications ran yet.
    var timerTick = function() {

      var offset = window.ntp.offset(); // time offset from the server in ms
      //$("div.tx-out").html(offset+ " ms ");
      //console.log("TICK 1 " + offset);

      window.setTimeout(timerTick, 3000);
    }

    timerTick();
  </script>
</body>

</html>
